<sky-demo-nav></sky-demo-nav>
<div class="sky-container">
    <h1>Writing unit tests for modals</h1>
    <p>The SKY UX <a routerLink="/components/modal">modal service</a> allows users to create and launch modals in a consistent way. There are several ways to create unit tests for the portions of your application that use modals.</p>

    <h2>Testing without mocking the modal service</h2>
    <p>
      The first way to unit test components that use the modal service is to create a test which sets off an action to launch the modal and actually interact with the modal within a test. This allows you to create tests that ensure data is passed properly to the launched modal, and then back to the caller of the modal service when the modal is saved. The following code shows the setup necessary for this sort of test:
    </p>

    <code class="sky-demo-code-newline">
      {{noMockSetup}}
    </code>
    <p>
      The first <code>beforeEach</code> function configures the testing module using our standard <code>SkyAppTestModule</code>. The second <code>beforeEach</code> function injects the <code>SkyModalService</code> and disposes it (ensuring that previous test modals are destroyed). It also saves a reference to <code>applicationRef</code>, which must be used to detect changes when interacting with the launched modal because the modal content lives outside of the currently tested component.
    </p>

    <p>
      After this setup, a component containing logic to launch a modal can be testing by doing something like the following test:
    </p>
    <code class="sky-demo-code-newline">
      {{noMockTest}}
    </code>
    <p>
      In this test example, the <code>ModalLaunchingComponent</code> is created, a button within the component is clicked which launches the modal, and a button within the modal is clicked to save the modal (in an actual test you might use <code>expect</code> statements to confirm that certain component properties are set after saving the modal).
    </p>

    <h2>Testing launching a component by mocking the modal service</h2>
    <p>
      Another way to unit test your component that launches modals is to mock the <code>SkyModalService</code>. This is usually the preferred methodology because it allows you to unit test your component that launches the modal in isolation. The following code shows the setup necessary for this sort of test:
    </p>

    <code class="sky-demo-code-newline">
      {{mockLaunchSetup}}
    </code>

    <p>
      In this example, we create a class that mocks the necessary modal service functionality. It provides an open function and saves the callback for the modal <code>closed</code> subscription. In the <code>beforeEach</code> function, we configure our testing module and override the <code>SkyModalService</code> provider with an instance of the <code>MockModalService</code> we defined.
    </p>

    <p>
      After this setup, a component containing logic to launch a modal can be testing using our <code>MockModalService</code> by doing something like the following test:
    </p>

    <code class="sky-demo-code-newline">
      {{mockLaunchTest}}
    </code>

    <p>
      In this test example, the <code>ModalLaunchingComponent</code> is created, a button within the component is clicked which launches the modal, and then our <code>MockModalService</code> is called to simulate the modal saving (in an actual test you might use <code>expect</code> statements to confirm that certain component properties are set after saving the modal).
    </p>

    <h2> Testing a modal component in isolation</h2>

    <p>
      You can also test the modal component itself in isolation (the component that is launched by the modal service). To do this, you must mock <code>SkyModalInstance</code>, <code>SkyModalHostService</code>, and <code>SkyModalConfiguration</code>. The following code shows the setup necessary for this sort of test:
    </p>

    <code class="sky-demo-code-newline">
      {{mockModalComponentSetup}}

    </code>

    <p>
      In this example, we create a classes that mock the necessary functionality for a modal component. After this setup, you can test your modal component in isolation by doing something like the following test:
    </p>

    <code class="sky-demo-code-newline">
      {{mockModalComponentTest}}
    </code>

    <p>
      In this test example, we create our modal component and test it like we could any other standalone component. Then, we can verify results of modal specific actions like save by using our <code>MockModalInstance</code>
    </p>

    <p><strong>Next step »</strong> <a routerLink="/learn/tutorials/test/e2e-test">Run an end-to-end test for a project</a></p>
    <p><strong>Previous step »</strong> <a routerLink="/learn/tutorials/test/unit-test">Run a unit test for a project</a></p>
</div>
